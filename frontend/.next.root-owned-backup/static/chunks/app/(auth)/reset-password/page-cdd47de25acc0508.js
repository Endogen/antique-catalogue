(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{7917:function(e,t,s){Promise.resolve().then(s.bind(s,5763))},5763:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var r=s(7437),a=s(2265),n=s(6648),o=s(7138),i=s(6463),l=s(1014),d=s(9343),c=s(537),u=s(2328),m=s(1295),x=s(495),h=s(6264);let f=e=>c.Ry({token:c.Z_().trim().min(1,e("Reset token is required")),password:c.Z_().min(8,e("Password must be at least 8 characters")),confirmPassword:c.Z_().min(1,e("Confirm your password")).min(8,e("Password must be at least 8 characters"))}).refine(e=>e.password===e.confirmPassword,{path:["confirmPassword"],message:e("Passwords do not match")}),p=e=>{var t,s;return null!==(s=null!==(t=e.get("token"))&&void 0!==t?t:e.get("t"))&&void 0!==s?s:""},b=[{title:"Fresh token",detail:"Tokens expire quickly for security, request a new one if needed."},{title:"New password",detail:"Use at least 8 characters with a mix of letters and numbers."},{title:"Sign in",detail:"Return to login once your reset is complete."}];function w(){let e=(0,i.useRouter)(),t=(0,i.useSearchParams)(),{status:s}=(0,u.a)(),{t:c}=(0,m.Q)(),[w,g]=a.useState(null),[j,y]=a.useState(null),v=a.useMemo(()=>f(c),[c]),{register:N,handleSubmit:k,setValue:P,formState:{errors:C,isSubmitting:S}}=(0,d.cI)({resolver:(0,l.F)(v),defaultValues:{token:p(t),password:"",confirmPassword:""}});a.useEffect(()=>{"authenticated"===s&&e.replace("/dashboard")},[s,e]),a.useEffect(()=>{let e=p(t);e&&P("token",e)},[t,P]);let R=async e=>{g(null),y(null);try{let t=await h.iJ.resetPassword({token:e.token.trim(),password:e.password});y(t.message||"Password reset successful.")}catch(e){g((0,h.k0)(e)?e.detail:"We couldn't reset your password. Please try again.")}};if("authenticated"===s)return(0,r.jsx)("div",{className:"col-span-full flex min-h-[60vh] items-center justify-center text-sm text-stone-500",children:c("Redirecting to your workspace...")});let _=!!j;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsxs)("header",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsxs)(o.default,{href:"/",className:"flex items-center gap-3",children:[(0,r.jsx)(n.default,{src:"/logo.png",alt:"Antique Catalogue",width:44,height:44,className:"rounded-full"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-display text-lg tracking-tight",children:c("Antique Catalogue")}),(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.35em] text-stone-500",children:c("Studio Archive")})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 text-sm text-stone-600",children:[(0,r.jsx)("span",{className:"hidden sm:inline",children:c("Need a reset token?")}),(0,r.jsx)(x.z,{variant:"outline",size:"sm",asChild:!0,children:(0,r.jsx)(o.default,{href:"/forgot-password",children:c("Request one")})})]})]}),(0,r.jsxs)("section",{className:"mt-10 rounded-3xl border border-stone-200 bg-white/90 p-8 shadow-sm",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.4em] text-amber-700",children:c("Set new password")}),(0,r.jsx)("h1",{className:"font-display mt-4 text-3xl text-stone-900",children:c("Update your credentials.")}),(0,r.jsx)("p",{className:"mt-3 text-sm text-stone-600",children:c("Paste the reset token from your email and choose a new password to regain access to your archive.")}),w?(0,r.jsx)("div",{role:"alert",className:"mt-6 rounded-2xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700",children:c(w)}):null,j?(0,r.jsxs)("div",{role:"status",className:"mt-6 rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700",children:[(0,r.jsx)("p",{className:"font-medium",children:c(j)}),(0,r.jsx)("p",{className:"mt-2 text-xs text-emerald-700",children:c("You can now sign in with your updated password.")})]}):null,(0,r.jsxs)("form",{className:"mt-6 space-y-5",onSubmit:k(R),children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-stone-700",htmlFor:"token",children:c("Reset token")}),(0,r.jsx)("input",{id:"token",type:"text",autoComplete:"one-time-code",disabled:_,className:"mt-2 w-full rounded-xl border border-stone-200 bg-white px-4 py-3 text-sm text-stone-900 shadow-sm transition focus:border-amber-300 focus:outline-none focus:ring-2 focus:ring-amber-200 disabled:cursor-not-allowed disabled:bg-stone-100","aria-invalid":C.token?"true":"false",placeholder:c("Paste your reset token"),...N("token")}),C.token?(0,r.jsx)("p",{className:"mt-2 text-xs text-rose-600",children:C.token.message}):null]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-stone-700",htmlFor:"password",children:c("New password")}),(0,r.jsx)("input",{id:"password",type:"password",autoComplete:"new-password",disabled:_,className:"mt-2 w-full rounded-xl border border-stone-200 bg-white px-4 py-3 text-sm text-stone-900 shadow-sm transition focus:border-amber-300 focus:outline-none focus:ring-2 focus:ring-amber-200 disabled:cursor-not-allowed disabled:bg-stone-100","aria-invalid":C.password?"true":"false",...N("password")}),C.password?(0,r.jsx)("p",{className:"mt-2 text-xs text-rose-600",children:C.password.message}):null]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"text-sm font-medium text-stone-700",htmlFor:"confirmPassword",children:c("Confirm password")}),(0,r.jsx)("input",{id:"confirmPassword",type:"password",autoComplete:"new-password",disabled:_,className:"mt-2 w-full rounded-xl border border-stone-200 bg-white px-4 py-3 text-sm text-stone-900 shadow-sm transition focus:border-amber-300 focus:outline-none focus:ring-2 focus:ring-amber-200 disabled:cursor-not-allowed disabled:bg-stone-100","aria-invalid":C.confirmPassword?"true":"false",...N("confirmPassword")}),C.confirmPassword?(0,r.jsx)("p",{className:"mt-2 text-xs text-rose-600",children:C.confirmPassword.message}):null]}),(0,r.jsx)(x.z,{type:"submit",size:"lg",className:"w-full",disabled:S||_,children:_?c("Password updated"):S?c("Updating password..."):c("Reset password")})]}),(0,r.jsxs)("div",{className:"mt-6 flex flex-wrap items-center justify-between gap-3 text-xs text-stone-500",children:[(0,r.jsx)("span",{children:c("Ready to return?")}),(0,r.jsx)(o.default,{href:"/login",className:"font-medium text-amber-700 hover:text-amber-800",children:c("Sign in")})]})]})]}),(0,r.jsxs)("aside",{className:"order-first lg:order-none",children:[(0,r.jsxs)("div",{className:"rounded-3xl border border-stone-200 bg-white/85 p-8 shadow-sm",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.4em] text-stone-500",children:c("Reset tips")}),(0,r.jsx)("h2",{className:"font-display mt-4 text-3xl text-stone-900",children:c("Keep your archive secure.")}),(0,r.jsx)("p",{className:"mt-3 text-sm text-stone-600",children:c("Password resets protect your catalogue and keep your private notes secure.")}),(0,r.jsx)("div",{className:"mt-6 space-y-4",children:b.map(e=>(0,r.jsxs)("div",{className:"rounded-2xl border border-stone-200 bg-stone-50/80 p-4",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-stone-900",children:c(e.title)}),(0,r.jsx)("p",{className:"mt-1 text-xs text-stone-500",children:c(e.detail)})]},e.title))})]}),(0,r.jsxs)("div",{className:"mt-6 rounded-3xl border border-stone-900/90 bg-gradient-to-br from-stone-950 via-stone-900 to-stone-800 p-6 text-stone-100 shadow-sm",children:[(0,r.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-stone-400",children:c("Studio reminder")}),(0,r.jsx)("p",{className:"mt-3 text-sm text-stone-300",children:c("Reset tokens are single-use and expire quickly. Request another token anytime you need.")})]})]})]})}function g(){let{t:e}=(0,m.Q)();return(0,r.jsx)(a.Suspense,{fallback:(0,r.jsx)("div",{className:"flex min-h-[60vh] items-center justify-center text-sm text-stone-500",children:e("Loading...")}),children:(0,r.jsx)(w,{})})}},2328:function(e,t,s){"use strict";s.d(t,{H:function(){return i},a:function(){return l}});var r=s(7437),a=s(2265),n=s(6264);let o=a.createContext(void 0),i=e=>{let{children:t}=e,[s,i]=a.useState(null),[l,d]=a.useState("loading"),[c,u]=a.useState(null),m=a.useCallback(async()=>{d("loading"),u(null);try{let e=await n.iJ.me();i(e),d("authenticated")}catch(e){i(null),(0,n.k0)(e)&&(401===e.status||403===e.status)?d("unauthenticated"):(d("unauthenticated"),u((0,n.k0)(e)?e.detail:"Unable to reach server"))}},[]);a.useEffect(()=>{m()},[m]);let x=a.useCallback(async e=>{u(null),await n.iJ.login(e),await m()},[m]),h=a.useCallback(async()=>{u(null);try{await n.iJ.logout()}finally{i(null),d("unauthenticated")}},[]),f=a.useCallback(async()=>{await m()},[m]),p=a.useMemo(()=>({user:s,status:l,error:c,isAuthenticated:"authenticated"===l,login:x,logout:h,refresh:f}),[s,l,c,x,h,f]);return(0,r.jsx)(o.Provider,{value:p,children:t})},l=()=>{let e=a.useContext(o);if(!e)throw Error("useAuth must be used within AuthProvider");return e}},495:function(e,t,s){"use strict";s.d(t,{z:function(){return d}});var r=s(7437),a=s(2265),n=s(2974),o=s(3027),i=s(7440);let l=(0,o.j)("inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:s,variant:a,size:o,asChild:d=!1,...c}=e,u=d?n.g7:"button";return(0,r.jsx)(u,{className:(0,i.cn)(l({variant:a,size:o,className:s})),ref:t,...c})});d.displayName="Button"},7440:function(e,t,s){"use strict";s.d(t,{cn:function(){return n}});var r=s(4839),a=s(6164);function n(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}}},function(e){e.O(0,[165,138,648,439,846,971,23,744],function(){return e(e.s=7917)}),_N_E=e.O()}]);