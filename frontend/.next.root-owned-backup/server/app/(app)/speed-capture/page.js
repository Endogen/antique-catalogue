(()=>{var e={};e.id=684,e.ids=[684],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3006:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>r.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>o}),s(2707),s(639),s(5866),s(9157);var a=s(3191),n=s(8716),l=s(7922),r=s.n(l),i=s(5231),c={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);s.d(t,c);let o=["",{children:["(app)",{children:["speed-capture",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2707)),"/home/endogen/projects/antique-catalogue/frontend/app/(app)/speed-capture/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,639)),"/home/endogen/projects/antique-catalogue/frontend/app/(app)/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,9157)),"/home/endogen/projects/antique-catalogue/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/home/endogen/projects/antique-catalogue/frontend/app/(app)/speed-capture/page.tsx"],m="/(app)/speed-capture/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(app)/speed-capture/page",pathname:"/speed-capture",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},6069:(e,t,s)=>{Promise.resolve().then(s.bind(s,6531))},6531:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var a=s(326),n=s(7577),l=s(6226),r=s(434),i=s(5047),c=s(3634),o=s(5290),d=s(6557);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,d.Z)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]),x=(0,d.Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var u=s(6333),p=s(1896),h=s(3855),g=s(276);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,d.Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);var j=s(772),v=s(6824),b=s(6115),y=s(1708),N=s(7863);function w({src:e,alt:t,className:s}){let n=(0,y.N)(e);return n?a.jsx(l.default,{src:n,alt:t,width:512,height:512,className:s,unoptimized:!0}):a.jsx("div",{"aria-hidden":"true",className:(0,N.cn)("bg-stone-100",s)})}function k({collections:e,loading:t,error:s,onSelect:n,onRetry:l}){let{t:i}=(0,b.Q)();return a.jsx("div",{className:"flex min-h-[60vh] flex-col items-center justify-center px-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-2xl bg-amber-50 text-amber-700",children:a.jsx(c.Z,{className:"h-8 w-8"})}),a.jsx("h1",{className:"font-display mt-4 text-2xl text-stone-900",children:i("Speed Capture")}),a.jsx("p",{className:"mt-2 text-sm text-stone-600",children:i("Pick a collection to start capturing. You can add metadata later.")})]}),t?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx(o.Z,{className:"h-6 w-6 animate-spin text-amber-600"})}):s?(0,a.jsxs)("div",{className:"space-y-3 rounded-2xl border border-rose-200 bg-rose-50 p-4 text-center",children:[a.jsx("p",{className:"text-sm text-rose-700",children:i(s)}),a.jsx(j.z,{size:"sm",variant:"outline",onClick:l,children:i("Try again")})]}):0===e.length?(0,a.jsxs)("div",{className:"space-y-3 rounded-2xl border border-stone-200 bg-white p-6 text-center",children:[a.jsx("p",{className:"text-sm text-stone-600",children:i("No collections yet. Create one first.")}),a.jsx(j.z,{size:"sm",variant:"secondary",asChild:!0,children:a.jsx(r.default,{href:"/collections/new",children:i("Create collection")})})]}):a.jsx("div",{className:"space-y-2",children:e.map(e=>(0,a.jsxs)("button",{type:"button",className:"flex w-full items-center gap-3 rounded-2xl border border-stone-200 bg-white px-4 py-3 text-left shadow-sm transition hover:border-amber-300 hover:bg-amber-50/50 active:scale-[0.98]",onClick:()=>n(e),children:[a.jsx("div",{className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl bg-stone-100 text-stone-500",children:a.jsx(m,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[a.jsx("p",{className:"truncate text-sm font-medium text-stone-900",children:e.name}),e.description?a.jsx("p",{className:"truncate text-xs text-stone-500",children:e.description}):null]}),a.jsx(x,{className:"h-4 w-4 -rotate-90 text-stone-400"})]},e.id))})]})})}function C({items:e,currentItemId:t}){let s=n.useRef(null),l=e.find(e=>e.itemId===t);return(n.useEffect(()=>{s.current&&(s.current.scrollLeft=s.current.scrollWidth)},[l?.images.length]),l&&0!==l.images.length)?a.jsx("div",{ref:s,className:"flex gap-2 overflow-x-auto pb-1 scrollbar-none",children:l.images.map(e=>a.jsx("div",{className:"relative h-14 w-14 flex-shrink-0 overflow-hidden rounded-xl border-2 border-white shadow-sm",children:a.jsx(w,{src:v.Rf.url(e.imageId,"thumb"),alt:"",className:"h-full w-full object-cover"})},e.id))}):null}function I({collection:e,items:t,currentItemId:s,uploading:l,uploadError:i,stats:c,existingDrafts:d,existingDraftsLoading:m,onCapture:x,onExit:y,onReview:N}){let{t:k}=(0,b.Q)(),I=n.useRef(null),_=n.useRef("new"),P=null!==s,L=e=>{_.current=e,I.current?.click()};return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex flex-col bg-stone-50",children:[a.jsx("input",{ref:I,type:"file",accept:"image/*",capture:"environment",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&x(t,_.current),e.target.value=""}}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 pb-2 pt-[max(env(safe-area-inset-top),0.75rem)]",children:[(0,a.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-sm text-stone-600 transition hover:text-stone-900",onClick:y,children:[a.jsx(u.Z,{className:"h-4 w-4"}),k("Exit")]}),a.jsx("p",{className:"truncate text-xs uppercase tracking-[0.2em] text-amber-700",children:e.name})]}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-6 py-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("p",{className:"font-display text-2xl text-stone-900",children:c.items}),a.jsx("p",{className:"text-xs text-stone-500",children:k(1===c.items?"item":"items")})]}),a.jsx("div",{className:"h-8 w-px bg-stone-200"}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("p",{className:"font-display text-2xl text-stone-900",children:c.images}),a.jsx("p",{className:"text-xs text-stone-500",children:k(1===c.images?"photo":"photos")})]})]}),a.jsx("div",{className:"min-h-[3.75rem] px-4",children:a.jsx(C,{items:t,currentItemId:s})}),m?a.jsx("div",{className:"flex items-center justify-center px-4 py-2",children:a.jsx(o.Z,{className:"h-4 w-4 animate-spin text-stone-400"})}):d.length>0?(0,a.jsxs)("div",{className:"px-4 pt-2",children:[a.jsx("p",{className:"mb-2 text-xs uppercase tracking-[0.2em] text-stone-400",children:k("Existing drafts")}),a.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-none",children:d.map(t=>(0,a.jsxs)(r.default,{href:`/collections/${e.id}/items/${t.id}`,className:"relative flex h-16 w-16 flex-shrink-0 items-center justify-center overflow-hidden rounded-xl border border-stone-200 bg-stone-100 shadow-sm",children:[t.primary_image_id?a.jsx(w,{src:v.Rf.url(t.primary_image_id,"thumb"),alt:t.name,className:"h-full w-full object-cover"}):a.jsx(p.Z,{className:"h-5 w-5 text-stone-400"}),(t.image_count??0)>1?a.jsx("span",{className:"absolute bottom-0.5 right-0.5 rounded-full bg-stone-900/70 px-1 py-px text-[10px] font-medium text-white",children:t.image_count}):null]},t.id))})]}):null,(0,a.jsxs)("div",{className:"flex flex-1 flex-col items-center justify-center gap-4 px-4",children:[l?(0,a.jsxs)("div",{className:"flex flex-col items-center gap-3",children:[a.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-amber-50",children:a.jsx(o.Z,{className:"h-10 w-10 animate-spin text-amber-600"})}),a.jsx("p",{className:"text-sm text-stone-600",children:k("Uploading...")})]}):(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:"flex h-20 w-20 items-center justify-center rounded-full bg-stone-100 text-stone-400",children:a.jsx(p.Z,{className:"h-10 w-10"})}),a.jsx("p",{className:"max-w-xs text-center text-sm text-stone-500",children:k(P?"Add another photo to the current item, or start a new one.":"Take a photo to create your first draft item.")})]}),i?a.jsx("div",{className:"rounded-xl border border-rose-200 bg-rose-50 px-4 py-2 text-sm text-rose-700",children:i}):null]}),(0,a.jsxs)("div",{className:"space-y-3 px-4 pb-[max(env(safe-area-inset-bottom),1rem)] pt-2",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(j.z,{className:"flex-1 gap-2 rounded-2xl py-6 text-base",onClick:()=>L("new"),disabled:l,children:[a.jsx(h.Z,{className:"h-5 w-5"}),k("New Item")]}),P?(0,a.jsxs)(j.z,{variant:"secondary",className:"flex-1 gap-2 rounded-2xl py-6 text-base",onClick:()=>L("same"),disabled:l,children:[a.jsx(g.Z,{className:"h-5 w-5"}),k("Same Item")]}):null]}),c.items>0?(0,a.jsxs)(j.z,{variant:"outline",className:"w-full gap-2 rounded-2xl py-5",onClick:N,disabled:l,children:[a.jsx(f,{className:"h-4 w-4"}),k("Done â€” Review drafts")]}):null]})]})}function _({collection:e,items:t,stats:s,onBack:n,onFinish:l}){let{t:i}=(0,b.Q)();return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("button",{type:"button",className:"flex items-center gap-2 text-sm text-stone-600 transition hover:text-stone-900",onClick:n,children:[a.jsx(u.Z,{className:"h-4 w-4"}),i("Back to capture")]})}),(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto flex h-14 w-14 items-center justify-center rounded-2xl bg-emerald-50 text-emerald-600",children:a.jsx(f,{className:"h-7 w-7"})}),a.jsx("h2",{className:"font-display mt-3 text-2xl text-stone-900",children:i("Capture complete")}),a.jsx("p",{className:"mt-1 text-sm text-stone-600",children:i("{items} items with {images} photos in {collection}",{items:s.items,images:s.images,collection:e.name})})]}),a.jsx("div",{className:"grid grid-cols-2 gap-3 sm:grid-cols-3 md:grid-cols-4",children:t.map(t=>(0,a.jsxs)(r.default,{href:`/collections/${e.id}/items/${t.itemId}`,className:"group overflow-hidden rounded-2xl border border-stone-200 bg-white shadow-sm transition hover:border-amber-300 hover:shadow-md",children:[t.images[0]?a.jsx("div",{className:"aspect-square overflow-hidden bg-stone-100",children:a.jsx(w,{src:v.Rf.url(t.images[0].imageId,"thumb"),alt:t.name,className:"h-full w-full object-cover transition group-hover:scale-105"})}):a.jsx("div",{className:"flex aspect-square items-center justify-center bg-stone-100 text-stone-400",children:a.jsx(p.Z,{className:"h-8 w-8"})}),(0,a.jsxs)("div",{className:"p-3",children:[a.jsx("p",{className:"truncate text-sm font-medium text-stone-900",children:t.name}),(0,a.jsxs)("p",{className:"text-xs text-stone-500",children:[t.images.length," ",1===t.images.length?i("photo"):i("photos")]})]})]},t.itemId))}),(0,a.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row",children:[a.jsx(j.z,{className:"flex-1 gap-2 rounded-2xl py-5",onClick:l,children:i("Go to collection")}),(0,a.jsxs)(j.z,{variant:"outline",className:"flex-1 gap-2 rounded-2xl py-5",onClick:n,children:[a.jsx(p.Z,{className:"h-4 w-4"}),i("Capture more")]})]})]})}function P(){let e=(0,i.useRouter)(),{t}=(0,b.Q)(),[s,l]=n.useState({status:"pick-collection",collections:[],collectionsLoading:!0,collectionsError:null,selectedCollection:null,items:[],currentItemId:null,uploading:!1,uploadError:null,stats:{items:0,images:0},existingDrafts:[],existingDraftsLoading:!1}),r=n.useCallback(async()=>{l(e=>({...e,collectionsLoading:!0,collectionsError:null}));try{let e=await v.Wo.list();l(t=>({...t,collections:e,collectionsLoading:!1}))}catch(e){l(t=>({...t,collectionsLoading:!1,collectionsError:(0,v.k0)(e)?e.detail:"Failed to load collections"}))}},[]);n.useEffect(()=>{r()},[r]);let c=async e=>{l(t=>({...t,status:"capturing",selectedCollection:e,items:[],currentItemId:null,uploadError:null,stats:{items:0,images:0},existingDrafts:[],existingDraftsLoading:!0}));try{let t=(await v.zg.list(e.id,{includeDrafts:!0,limit:100,sort:"-created_at"})).filter(e=>e.is_draft);l(e=>({...e,existingDrafts:t,existingDraftsLoading:!1}))}catch{l(e=>({...e,existingDraftsLoading:!1}))}},o=async(e,t)=>{if(s.selectedCollection){l(e=>({...e,uploading:!0,uploadError:null}));try{if("new"===t||null===s.currentItemId){let t=await v.$Q.newItem(s.selectedCollection.id,e),a={itemId:t.item_id,name:t.item_name,images:[{id:`${t.image_id}`,imageId:t.image_id}]};l(e=>{let s=[...e.items,a];return{...e,uploading:!1,items:s,currentItemId:t.item_id,stats:{items:e.stats.items+1,images:e.stats.images+1}}})}else{let t=await v.$Q.addImage(s.selectedCollection.id,s.currentItemId,e);l(e=>{let s=e.items.map(s=>s.itemId===e.currentItemId?{...s,images:[...s.images,{id:`${t.image_id}`,imageId:t.image_id}]}:s);return{...e,uploading:!1,items:s,stats:{items:e.stats.items,images:e.stats.images+1}}})}}catch(e){l(t=>({...t,uploading:!1,uploadError:(0,v.k0)(e)?e.detail:"Failed to upload image"}))}}};return"pick-collection"===s.status?a.jsx(k,{collections:s.collections,loading:s.collectionsLoading,error:s.collectionsError,onSelect:c,onRetry:r}):"reviewing"===s.status&&s.selectedCollection?a.jsx(_,{collection:s.selectedCollection,items:s.items,stats:s.stats,onBack:()=>{l(e=>({...e,status:"capturing"}))},onFinish:()=>{s.selectedCollection?e.push(`/collections/${s.selectedCollection.id}?include_drafts=true`):e.push("/collections")}}):s.selectedCollection?a.jsx(I,{collection:s.selectedCollection,items:s.items,currentItemId:s.currentItemId,uploading:s.uploading,uploadError:s.uploadError,stats:s.stats,existingDrafts:s.existingDrafts,existingDraftsLoading:s.existingDraftsLoading,onCapture:o,onExit:()=>{s.items.length>0?l(e=>({...e,status:"reviewing"})):l(e=>({...e,status:"pick-collection",selectedCollection:null,items:[],currentItemId:null,uploadError:null,stats:{items:0,images:0},existingDrafts:[],existingDraftsLoading:!1}))},onReview:()=>{l(e=>({...e,status:"reviewing"}))}}):null}},1708:(e,t,s)=>{"use strict";s.d(t,{N:()=>n});var a=s(7577);function n(e){let[t,s]=a.useState(null);return a.useEffect(()=>{if(!e){s(e=>(e&&URL.revokeObjectURL(e),null));return}let t=null,a=new AbortController;return(async()=>{try{let n=await fetch(e,{headers:{},cache:"no-store",signal:a.signal});if(!n.ok){s(null);return}let l=await n.blob();t=URL.createObjectURL(l),s(e=>(e&&URL.revokeObjectURL(e),t))}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return;s(null)}})(),()=>{a.abort(),t&&URL.revokeObjectURL(t)}},[e]),t}},6333:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(6557).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},1896:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(6557).Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]])},276:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(6557).Z)("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])},5290:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(6557).Z)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},3855:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(6557).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5047:(e,t,s)=>{"use strict";var a=s(7389);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},2707:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>r,__esModule:()=>l,default:()=>i});var a=s(8570);let n=(0,a.createProxy)(String.raw`/home/endogen/projects/antique-catalogue/frontend/app/(app)/speed-capture/page.tsx`),{__esModule:l,$$typeof:r}=n;n.default;let i=(0,a.createProxy)(String.raw`/home/endogen/projects/antique-catalogue/frontend/app/(app)/speed-capture/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[716,697,449,373],()=>s(3006));module.exports=a})();